<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-orientation" content="landscape">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-title" content="Bubbles VR">
    <meta name="format-detection" content="telephone=no">
    <!-- <link rel="apple-touch-icon" href="icon.png"> -->
    <meta name="apple-touch-fullscreen" content="yes">
    <link rel="manifest" href="../manifest.json">
    <link rel="stylesheet" href="./style.css">

    <title>BubblesVR</title>
  </head>
  <body>

    <div id="app-root">
        <!-- Three.js will append canvas here or you can place it inside -->
    </div>

    <!-- First-tap UI (needed for iOS motion + video playback permissions) -->
    <div id="ui">
      <div id="ui-buttons" class="panel">
        <div style="font-weight:700; font-size: 18px;">BubblesVR</div>
        <div>Tap “Enter VR” and grant motion permissions.</div>
        <div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
          <button id="enter">Enter VR</button>
          <button id="scan-qr" style="background:rgba(255,255,255,.2); color:#fff; border:1px solid rgba(255,255,255,.4);">Load dataset</button>
          <button id="clear-qr" style="background:rgba(255,255,255,.2); color:#fff; border:1px solid rgba(255,255,255,.4); display:none;">Clear dataset</button>
        </div>
      </div>
    </div>

    <!-- VR view: landscape required overlay (shown when in VR but phone is portrait) -->
    <div id="vr-landscape-overlay" hidden>
      <div class="panel">
        <div style="font-weight:700; font-size: 18px;">BubblesVR</div>
        <div>Please switch your phone to landscape mode for VR view.</div>
      </div>
    </div>

    <!-- QR Scanner overlay -->
    <div id="qr-scanner" class="qr-overlay" hidden>
      <div class="qr-overlay-header">
        <div class="qr-overlay-header-text">
          <span>Point camera at QR code</span>
          <span class="qr-overlay-header-hint">Create one at <a href="https://radogit.github.io/cocoarui/" target="_blank" rel="noopener">radogit.github.io/cocoarui</a> — or use the demo below.</span>
        </div>
        <button id="qr-scanner-close" class="qr-close" aria-label="Close">×</button>
      </div>
      <video id="qr-video" playsinline muted></video>
      <canvas id="qr-canvas" hidden></canvas>
      <div class="qr-overlay-footer">
        <button id="qr-load-demo" type="button" class="qr-clear-btn">Load demo dataset</button>
        <button id="qr-clear-stored" type="button" class="qr-clear-btn">Clear stored dataset</button>
      </div>
    </div>

    <!-- Add to Home Screen tip (Safari only, hidden in PWA) -->
    <div id="add-to-homescreen-tip">
      <div class="tip-header">
        <span class="tip-title">Best VR Experience</span>
        <button class="tip-close" id="add-to-homescreen-tip-close" aria-label="Close">×</button>
      </div>
      <div class="tip-body">
        [iOS] For the best full-screen VR experience, please install this app to your Home Screen.
        <ol>
          <li>
            Tap the
            <span style="background: #555; padding: 4px 4px;"><!-- Share icon -->
              <svg aria-hidden="true" focusable="false" width="20" height="20" viewBox="0 0 24 24" style="margin: 0 -2px -4px -4px;"">
                <defs>
                  <!-- Mask: keep everything (white), then cut a small notch (black) out of the top edge -->
                  <mask id="top-notch">
                    <rect width="24" height="24" fill="white"></rect>
                    <!-- Notch position/size tuned for iOS-like gap where the arrow crosses -->
                    <rect y="7.7" height="3.8" rx="1.2" fill="black" x="9.7" width="4.6"></rect>
                  </mask>
                </defs>
              
                <!-- Rounded square stroke with the notch masked out -->
                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" mask="url(#top-notch)" stroke-width="1.5">
                  <!-- Rounded square: newer iOS feels slightly “squarer” than older versions but still very rounded -->
                  <rect x="6" width="12" height="12" rx="3.1" y="10"></rect>
                </g>
              
                <!-- Arrow (drawn after, on top) -->
                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
                  <!-- stem -->
                  <path d="M12 12V4.6"></path>
                  <!-- head -->
                  <path d="M8.9 6.7L12 3.6l3.1 3.1"></path>
                </g>
                </svg> Share</span> button, then
          </li>
          <li>
              <span style="background: #555; padding: 4px 4px;">
                <svg class="ios-icon stroke" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <rect x="1" y="1" width="22" height="22" rx="5"></rect>
                <path d="M12 8v8"></path>
                <path d="M8 12h8"></path>
              </svg> Add to Home Screen
            </span>
          </li>
        </ol>
      </div>
    </div>

    <!-- On-screen HUD: drawer with handle at top, content slides down when collapsed -->
    <div id="hud" class="hidden">
      <div id="hud-drawer">
        <button id="hud-drawer-handle" type="button" title="Show/hide controls" aria-label="Toggle controls"></button>
        <div id="hud-drawer-content">
          <div class="hud-row">
            <button id="recenter" hidden>Recenter</button>
            <button id="fullscreen" hidden>Fullscreen</button>
            <button id="toggle-axis" class="hud-toggle" title="Show/hide axis">Axis</button>
            <button id="toggle-grid-v" class="hud-toggle" title="Show/hide vertical grid">Grid V</button>
            <button id="toggle-grid-h" class="hud-toggle" title="Show/hide horizontal grid">Grid H</button>
            <button id="toggle-node-circles" class="hud-toggle" title="Show/hide node circles">Circles</button>
            <button id="toggle-node-labels" class="hud-toggle" title="Show/hide node labels">Labels</button>
            <button id="toggle-node-icons" class="hud-toggle" title="Show/hide node icons">Icons</button>
          </div>
          <div class="hud-row">
            <button id="playpause">⏯</button>
            <div class="video-btn-group" role="group" aria-label="Video preset">
              <button id="video-vr-uphill" class="video-btn" data-preset="vr-uphill">VR↑</button>
              <button id="video-vr-downhill" class="video-btn" data-preset="vr-downhill">VR↓</button>
              <button id="video-base-uphill" class="video-btn" data-preset="base-uphill">PP↑</button>
              <button id="video-base-downhill" class="video-btn" data-preset="base-downhill">PP↓</button>
            </div>
          </div>
          <div class="hud-row hud-row-opacity">
            <label for="bg-opacity-slider" class="hud-label">Background opacity</label>
            <input type="range" id="bg-opacity-slider" min="0" max="100" value="100" title="Background video opacity">
          </div>
          <div class="hud-row hud-row-opacity">
            <label for="flip-on-loop" class="hud-checkbox-label">
              <input type="checkbox" id="flip-on-loop" checked>
              Mirror video on loop
            </label>
          </div>
          <div class="hud-row">
            <button id="scan-qr-hud" style="background:rgba(255,255,255,.2); color:#fff; border:1px solid rgba(255,255,255,.4);">Load dataset</button>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="./main.js"></script>
  </body>
</html>
